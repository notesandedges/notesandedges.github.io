<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>notes&edges</title>
    <link rel="stylesheet" type="text/css" href="/css/base.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <style>
        body {
            margin: 0.5in;
        }
        
        .headers {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .headers h1, .headers h3 {
            margin: 0;
            padding: 0;
        }

        .headers a {
            text-decoration: none;
            color: inherit;
        }
        
        #network-container {
            width: 66%;
            height: 300px;
            margin: 20px auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .node {
            fill: #69b3a2;
            stroke: #fff;
            stroke-width: 2px;
        }
        
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
        }
        
        .node-label {
            font-size: 10px;
            font-family: sans-serif;
        }

        .node-label-background {
            fill: white;
            fill-opacity: 0.8;
        }
        
        .tooltip {
            position: absolute;
            background-color: white;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            pointer-events: none;
            opacity: 0;
        }

        .text {
            clear: both;
            padding-top: 20px;
        }

        .tiny h3 a {
            margin: 0 10px;
        }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <!-- Header content remains the same -->
    <div class="headers">
        <h1><a href="index.html">notes&edges</a></h1>
        <div class="tiny">
            <h3>
                <a href="index.html">Home</a>
                <a href="manuscriptor.html">Manuscriptor</a>
                <a href="thoughts.html">Thoughts</a>
                <a href="https://github.com/notesandedges/notesandedges.github.io">Github</a>
            </h3>
        </div>
    </div>

    <div class="text">
        <p> I am a PhD graduate from the University of California, San Diego. My thesis focused on multiscale 
            intracellular electrical and electrochemical sensing of neuronal networks and cardiac monolayers.
            My focus is using subcellular biosensors to elucide mechanisms of disease within electrically active tissue,
            and to ultimately develop affordable clinical biosensors to increase global healthcare accessibility.
        </p>
        <p style="margin-top: 10px;"> 
            <a href="https://drive.google.com/file/d/1fZSccGt6W7G3B9H_Qr4O9hw2-ufMquOr/view?usp=sharing">CV</a>, 
            <a href="https://drive.google.com/file/d/185Z3D17CCJN-ympuGZv2zkl6proRfy-X/view?usp=sharing">Resume</a>,
            <a href="https://www.linkedin.com/in/srshukla">Linkedin</a>
        </p>
        <p style="margin-top: 5px;">Interactive visualization of semantic relationships between my publications:</p>
        <div id="network-container"></div>
    </div>

    <script>
        const width = document.getElementById('network-container').offsetWidth;
        const height = 300;

        const svg = d3.select('#network-container')
            .append('svg')
            .attr('width', width)
            .attr('height', height);

        const tooltip = d3.select('body')
            .append('div')
            .attr('class', 'tooltip');

        function wrapText(text, width) {
            text.each(function() {
                const text = d3.select(this);
                const words = text.text().split(/\s+/).reverse();
                const lineHeight = 1.1; // ems
                const y = text.attr("y");
                const dy = parseFloat(text.attr("dy"));
                
                let word;
                let line = [];
                let lineNumber = 0;
                let tspan = text.text(null).append("tspan")
                    .attr("x", text.attr("x"))
                    .attr("y", y)
                    .attr("dy", dy + "em");

                // Limit to 5 lines
                while (word = words.pop()) {
                    line.push(word);
                    tspan.text(line.join(" "));
                    if (tspan.node().getComputedTextLength() > width) {
                        if (lineNumber >= 4) { // 0-based index, so 4 means 5 lines
                            // Add ellipsis to last line if there are more words
                            if (words.length > 0) {
                                line.pop();
                                line.push("...");
                                tspan.text(line.join(" "));
                            }
                            break;
                        }
                        line.pop();
                        tspan.text(line.join(" "));
                        line = [word];
                        tspan = text.append("tspan")
                            .attr("x", text.attr("x"))
                            .attr("y", y)
                            .attr("dy", ++lineNumber * lineHeight + dy + "em")
                            .text(word);
                    }
                }
            });
        }

        async function visualizeNetwork() {
            try {
                const response = await fetch('https://srshukla.pythonanywhere.com/api/publication-network');
                const data = await response.json();

                const simulation = d3.forceSimulation(data.nodes)
                    .force('link', d3.forceLink(data.links).id(d => d.id))
                    .force('charge', d3.forceManyBody().strength(-100)) // Increased repulsion
                    .force('center', d3.forceCenter(width / 2, height / 2))
                    .force('collide', d3.forceCollide().radius(40)); // Increased collision radius

                const link = svg.append('g')
                    .selectAll('line')
                    .data(data.links)
                    .join('line')
                    .attr('class', 'link')
                    .attr('stroke-width', d => Math.sqrt(d.value) * 2);

                const node = svg.append('g')
                    .selectAll('circle')
                    .data(data.nodes)
                    .join('circle')
                    .attr('class', 'node')
                    .attr('r', 6)
                    .call(drag(simulation));

                // Add background rectangles for labels
                const labelBackground = svg.append('g')
                    .selectAll('rect')
                    .data(data.nodes)
                    .join('rect')
                    .attr('class', 'node-label-background')
                    .attr('width', 120)
                    .attr('height', 60)
                    .attr('x', -60)
                    .attr('y', -30);

                const label = svg.append('g')
                    .selectAll('text')
                    .data(data.nodes)
                    .join('text')
                    .attr('class', 'node-label')
                    .attr('dx', 8)
                    .attr('dy', -2)
                    .text(d => d.title)
                    .call(wrapText, 100);

                node.on('mouseover', (event, d) => {
                    tooltip.transition()
                        .duration(200)
                        .style('opacity', .9);
                    tooltip.html(`
                        <strong>${d.title}</strong><br/>
                        Year: ${d.year}
                    `)
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', () => {
                    tooltip.transition()
                        .duration(500)
                        .style('opacity', 0);
                });

                simulation.on('tick', () => {
                    node
                        .attr('cx', d => Math.max(6, Math.min(width - 6, d.x)))
                        .attr('cy', d => Math.max(6, Math.min(height - 6, d.y)));

                    link
                        .attr('x1', d => d.source.x)
                        .attr('y1', d => d.source.y)
                        .attr('x2', d => d.target.x)
                        .attr('y2', d => d.target.y);

                    labelBackground
                        .attr('x', d => d.x - 60)
                        .attr('y', d => d.y - 30);

                    label.selectAll('tspan')
                        .attr('x', d => d.x + 8);
                    
                    label
                        .attr('x', d => d.x)
                        .attr('y', d => d.y);
                });
            } catch (error) {
                console.error('Error loading network data:', error);
            }
        }

        function drag(simulation) {
            function dragstarted(event) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                event.subject.fx = event.subject.x;
                event.subject.fy = event.subject.y;
            }

            function dragged(event) {
                event.subject.fx = event.x;
                event.subject.fy = event.y;
            }

            function dragended(event) {
                if (!event.active) simulation.alphaTarget(0);
                event.subject.fx = null;
                event.subject.fy = null;
            }

            return d3.drag()
                .on('start', dragstarted)
                .on('drag', dragged)
                .on('end', dragended);
        }

        visualizeNetwork();
    </script>

    <center><h6>Copyright &copy; 2025</h6></center>
</body>
</html>
